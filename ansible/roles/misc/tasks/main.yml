---
- name: create directories in user_home
  file:
    path: "{{ user_home }}/{{ item.path }}"
    state: directory
    owner: "{{ user_name }}"
    group: "{{ user_group }}"
  loop:
    - { path: .local/bin }
    - { path: .vim }
    - { path: .vim/ultisnips }
    - { path: .config/newsboat }
    - { path: documents }
    - { path: downloads }
    - { path: downloads/bandcamp-dl }
    - { path: downloads/firefox }
    - { path: pictures }
    - { path: pictures/screenshots }
    - { path: sync }

- name: create .dotfiles.local symlink
  file:
    src: '{{ user_home }}/.dotfiles.local'
    dest: '{{ dotfiles_home }}/.dotfiles.local'
    state: link

# https://wiki.archlinux.org/index.php/GNOME/Keyring#PAM_method
- name: configure PAM for GNOME Keyring
  lineinfile:
    path: /etc/pam.d/login
    line: '{{ item.line }}'
    regexp: '{{ item.line }}'
    insertafter: '{{ item.pattern }}'
  loop:
    - {
      line: 'auth       optional     pam_gnome_keyring.so',
      pattern: '^auth'
    }
    - {
      line: 'session    optional     pam_gnome_keyring.so auto_start',
      pattern: '^session'
    }

- name: configure default directory for Syncthing
  lineinfile:
    path: '{{ user_home }}/.config/syncthing/config.xml'
    # Keep the indentation level.
    line: '        <defaultFolderPath>~/sync</defaultFolderPath>'
    regexp: '<defaultFolderPath>.*</defaultFolderPath>'

- name: configure pacman
  lineinfile:
    path: '/etc/pacman.conf'
    line: 'VerbosePkgLists'
    regexp: '^#[ ]?VerbosePkgLists$'

- name: install sqlint
  become: yes
  become_user: "{{ user_name }}"
  command:
    # Simple SQL linter supporting ANSI and PostgreSQL syntaxes.
    cmd: gem install sqlint

- name: get submodules
  become: yes
  become_user: "{{ user_name }}"
  command:
    cmd: git submodule update --init --recursive
    chdir: "{{ dotfiles_home }}"
