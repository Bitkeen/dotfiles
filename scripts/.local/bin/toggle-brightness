#!/bin/sh
# Toggle screen brightness level from 0% to 70% using light.
# Switch focus between displays on toggle.

workspaces="$(i3-msg -t get_workspaces | jq '.[]')"

get_ws(){
    # Get an i3 workspace.
    # Query by display ($1) and state - visible, focused, etc. ($2).
    # shellcheck disable=SC2140
    echo "$workspaces" |
        jq --raw-output "select(.output == "\""$1"\"" and .$2 == true).name"
}

if [ "$(light)" = '0.00' ]; then
    [ -n "$(get_ws 'HDMI1' 'focused')" ] &&
        i3-msg "workspace $(get_ws 'eDP1' 'visible')"

    light -S 70
else
    [ -n "$(get_ws 'eDP1' 'focused')" ] &&
        i3-msg "workspace $(get_ws 'HDMI1' 'visible')"

    light -S 0
fi
